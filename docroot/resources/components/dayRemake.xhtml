<?xml version="1.0" encoding="UTF-8"?>
<ui:component
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:aui="http://liferay.com/faces/aui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:cc="http://java.sun.com/jsf/composite"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:components="http://java.sun.com/jsf/composite/components" >

	<cc:interface>
		<cc:attribute name="controllerBean" />
		<cc:attribute name="controllerName" />
	</cc:interface>

	<cc:implementation>
		<aui:form>
			<pe:timeline
				id="dayRemake" editable="true" start="#{cc.attrs.dayStart}" eventMargin="1"
				minHeight="300" end="#{cc.attrs.controllerBean.dayRemakeViewBean.dayEnd}"
				min="#{cc.attrs.controllerBean.dayRemakeViewBean.min}" stackEvents="true"
				max="#{cc.attrs.controllerBean.dayRemakeViewBean.max}" snapEvents="true" axisOnTop="true"
				showButtonNew="true" showNavigation="true"
				value="#{cc.attrs.controllerBean.dayRemakeViewBean.dayRemakeModel}" var="taskSession"
				zoomMin="#{cc.attrs.controllerBean.dayRemakeViewBean.zoomMin}"
				zoomMax="#{cc.attrs.controllerBean.dayRemakeViewBean.zoomMax}"
				widgetVar="dayRemakeWidget">

				<p:ajax event="change" update="@none" listener="#{cc.attrs.controllerBean.dayRemakeViewBean.onChange}" />
				<p:ajax event="add" update="addTaskDialog" oncomplete="PF('addTaskWidget').show()" />

				<pe:javascript event="change" execute="changeEvent()" />

				<h:panelGrid columns="1">
					<h:outputText value="#{taskSession.formattedDuration}" />
					<h:outputText value="#{taskSession.getTask().getTaskName()}" />
				</h:panelGrid>
			</pe:timeline>

			<p:dialog id="addTaskDialog" header="Add Task" widgetVar="addTaskWidget"
				showEffect="clip" hideEffect="clip">

				<aui:layout>
					<aui:column>
						<aui:fieldset>
							<aui:field label="Start">
								<h:inputText id="startTime" maxlength="4" styleClass="start-time" value="#{cc.attrs.controllerBean.taskSessionModelBean.startTime}">
									<f:converter converterId="TimeSheetConverter" />
									<f:validator validatorId="StartTimeValidator" />
								</h:inputText>
							</aui:field>

							<aui:field label="End">
								<h:inputText id="endTime" maxlength="4" styleClass="end-time" value="#{cc.attrs.controllerBean.taskSessionModelBean.endTime}">
									<f:converter converterId="TimeSheetConverter" />
									<f:validator validatorId="EndTimeValidator" />
								</h:inputText>
							</aui:field>

							<aui:field label="Task">
								<p:selectOneMenu value="#{cc.attrs.controllerBean.taskSessionModelBean.selectedTask}" var="task">
									<f:selectItem itemLabel="Select Task" itemValue="" />
									<f:selectItems value="#{cc.attrs.controllerBean.taskModelBean.tasksByUser}" itemValue="#{task}" 
										itemLabel="#{task.getShortTaskName()}" converter="TaskConverter"/>
								</p:selectOneMenu>
							</aui:field>

							<aui:field label="Description">
								<h:inputTextarea id="description" styleClass="description" value="#{cc.attrs.controllerBean.taskSessionModelBean.description}" />
							</aui:field>
						</aui:fieldset>

						<aui:button-row>
							<h:commandButton action="#{cc.attrs.controllerBean.addTaskSessionAction}" label="Add" >
							
							</h:commandButton>
						</aui:button-row>
					</aui:column>
				</aui:layout>
			</p:dialog>

			<ui:include src="js/dayRemakeJS.xhtml"/> 
		</aui:form>
	</cc:implementation>
</ui:component>